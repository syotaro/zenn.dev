---
title: "良いコミットメッセージのルールメモ"
emoji: "🌟"
type: "idea" # tech: 技術記事 / idea: アイデア
topics: [git]
published: true
---

- [1. はじめに](#1.-%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB)
- [2. なぜ良くしたいか](#2.-%E3%81%AA%E3%81%9C%E8%89%AF%E3%81%8F%E3%81%97%E3%81%9F%E3%81%84%E3%81%8B)
- [3. いいコミットメッセージの定義](#3.-%E3%81%84%E3%81%84%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E5%AE%9A%E7%BE%A9)
  - [3.1. なぜそのコードの変更をしたのかがわかる](#3.1.-%E3%81%AA%E3%81%9C%E3%81%9D%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E5%A4%89%E6%9B%B4%E3%82%92%E3%81%97%E3%81%9F%E3%81%AE%E3%81%8B%E3%81%8C%E3%82%8F%E3%81%8B%E3%82%8B)
  - [3.2. ぱっと見で理解しやすい](#3.2.-%E3%81%B1%E3%81%A3%E3%81%A8%E8%A6%8B%E3%81%A7%E7%90%86%E8%A7%A3%E3%81%97%E3%82%84%E3%81%99%E3%81%84)
  - [3.3. 関連する情報への誘導](#3.3.-%E9%96%A2%E9%80%A3%E3%81%99%E3%82%8B%E6%83%85%E5%A0%B1%E3%81%B8%E3%81%AE%E8%AA%98%E5%B0%8E)
- [4. 具体的なルール](#4.-%E5%85%B7%E4%BD%93%E7%9A%84%E3%81%AA%E3%83%AB%E3%83%BC%E3%83%AB)
  - [4.1. コミットサマリの先頭には、プレフィックスをつける](#4.1.-%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%82%B5%E3%83%9E%E3%83%AA%E3%81%AE%E5%85%88%E9%A0%AD%E3%81%AB%E3%81%AF%E3%80%81%E3%83%97%E3%83%AC%E3%83%95%E3%82%A3%E3%83%83%E3%82%AF%E3%82%B9%E3%82%92%E3%81%A4%E3%81%91%E3%82%8B)
- [5. コミットメッセージ例](#5.-%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E4%BE%8B)
- [人間と機械が読みやすく、意味のあるコミットメッセージにするための仕様](#%E4%BA%BA%E9%96%93%E3%81%A8%E6%A9%9F%E6%A2%B0%E3%81%8C%E8%AA%AD%E3%81%BF%E3%82%84%E3%81%99%E3%81%8F%E3%80%81%E6%84%8F%E5%91%B3%E3%81%AE%E3%81%82%E3%82%8B%E3%82%B3%E3%83%9F%E3%83%83%E3%83%88%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AB%E3%81%99%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E4%BB%95%E6%A7%98)
- [6. REFERENCE](#6.-reference)

## 1. はじめに

開発において、メッセージを書く機会は多い。
コード/テストコード/コミットログ/コードコメントなど。
これらは、書く時間より読まれる時間のほうが長いので、書く時のコストより読む人にとってのコストを意識して、書くべき。

各々については、下記を意識すると良い。

| 対象               | 記述内容で意識すること                                                                                                                                                                        |
| ------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| コード             | **How** （どのように動かすか）                                                                                                                                                                |
| テストコード       | **What** （テスト対象コードの仕様は何をするものか）                                                                                                                                           |
| コミットメッセージ | **Why**（コードやテストコードから読み取れない、「それはなぜその変更をしているのか」という情報）                                                                                               |
| コードコメント     | **Why not**（なぜやってないかの理由） <br/>コードの説明をしてしまうと、二重管理になってしまう為、避ける。<br/><br/>例：ここは XXX を使うべきだが、hogehogeの理由で仕方なく YYY を使っている） |

## 2. なぜ良くしたいか

- チーム作業において、円滑な共同編集ができるようにしたい。
- 「良い変更履歴」を定義しルール化することで、認識ずれや理解やレビューにかかる時間のロスを減らす。
- コミットのメッセージから、コミットの内容がある程度予想できるようにすることで、他のメンバーが理解にかかる時間を短縮したい。

## 3. いいコミットメッセージの定義

### 3.1. なぜそのコードの変更をしたのかがわかる

望ましいのは、`コードをどのように変更したのか`ではなく`なぜコードを変更したのか`が書かれていること。
コードをどのように変更したのか、はコードの変更履歴を見ればわかるが、「`なぜコードを変更したのか`」はコードの変更履歴だけではわからない為。また、`なぜコードを変更したのか`が説明できるコミットの粒度にするべき。

- 1つの目的に対して、1つのコミットとする
- 意味のない（なぜを説明できない）コミットはまとめる
- コミットは、プリリクエストによるレビュー時に、見られる前提で作る（レビューしやすいコミットを心がける）

### 3.2. ぱっと見で理解しやすい

何のコード変更なのかがカテゴライズされている、以下のような「プレフィックス（後述）」を先頭に付ける。

### 3.3. 関連する情報への誘導

コードの差分だけでは読み解けない、書き手の背景を理解する上で必要な情報を、（存在する場合）書く
たとえば仕様が記載されたドキュメントURLや、関連チケット番号、チャットツールのメッセージURLなどをコミットメッセージに書くなど。

## 4. 具体的なルール

### 4.1. コミットサマリの先頭には、プレフィックスをつける

| プレフィックス | 説明                                                                                             |
| -------------- | ------------------------------------------------------------------------------------------------ |
| **feat:**      | 新機能                                                                                           |
| **fix:**       | バグの修正                                                                                       |
| **docs:**      | ドキュメントのみの変更                                                                           |
| **style:**     | コードの動作に影響しない、見た目だけの変更（スペース、フォーマット、欠落の修正、セミコロンなど） |
| **refactor:**  | バグの修正や機能の追加ではないコードの変更                                                       |
| **perf:**      | パフォーマンスを向上させるコードの変更                                                           |
| **test:**      | 不足しているテストの追加や既存のテストの修正                                                     |
| **chore:**     | ビルドプロセスやドキュメント生成などの補助ツールやライブラリの変更                               |

## 5. コミットメッセージ例

過去形にしない。（可能であれば）影響範囲（スコープ）が想像できる内容にする。

- ❌ 不具合が起きていたので、修正した
- ❌ apidoc更新
- ❌ レビュー指摘対応
- ⭕️ refactor: 重複する関数の記述を1つにまとめた
- ⭕️ refactor: XXXという変数がXXXXという誤解を招いたため、より意味のある名前に変更
- ⭕️ refactor: ugafugaというメソッドは非推奨になったので推奨されるメソッドに変更
- ⭕️ fix: hogehogeというサードパーティモジュールにはこういう脆弱性があるので脆弱性がないものに変更
- ⭕️ doc: typo
- ⭕️ perf: ユーザ一覧画面にて、必要なデータをDBから取得するロジックでN+1が発生していたので、実行しているクエリの条件式でin句を使うように修正

あとは、メッセージの先頭に絵文字を入れて、モチベーションを上げるカルチャーも一部ではあるらしい（あまり使わない）

- 例： 🎉 :sparkles: ISSUE #XXで定義した新機能を追加
  - 参考：https://www.webfx.com/tools/emoji-cheat-sheet/

## 人間と機械が読みやすく、意味のあるコミットメッセージにするための仕様

「Conventional Commits」という仕様がある。

概要は、下記のスライドがわかりやすかった。

https://speakerdeck.com/cocoeyes02/lets-use-conventional-commits

ただ、このルール、覚えるのも大変だし、チーム内で共通認識取るのも大変そうだ。
と、思っていたら、vscode拡張があった。

https://marketplace.visualstudio.com/items?itemName=vivaxy.vscode-conventional-commits

使ってみたところ、大変使い心地が良かった。
この拡張を共有すれば、チーム内の統一もやりやすそうだ。

![ 2022-05-13 230459](https://i.imgur.com/AOA3Dcl.png)

## 6. REFERENCE

- [angular.js/DEVELOPERS.md at master · angular/angular.js](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines)
- [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/#summary)
